authconfig --enableshadow --passalgo=sha512
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"
cdrom
clearpart --all
firewall --disabled
install
keyboard us
lang en_US.UTF-8
network --onboot yes --device eth0 --bootproto dhcp --noipv6
reboot
rootpw  --plaintext root
selinux --disabled
skipx
text
timezone --utc Etc/UTC
unsupported_hardware
zerombr

%include /tmp/disk.cfg

%pre
mypart=xfs

if [ -f /etc/centos-release ]; then
	myrel=`awk '{print $3}' /etc/centos-release`
	if [ "${myrel}" = 'release' ]; then
		myrel=`awk '{print $4}' /etc/centos-release`
	fi

	mymaj="${myrel%%.*}"
	mypart=xfs

	if [ "${mymaj}" -lt 7 ]; then
		mypart=ext4
	fi
elif [ -f /mnt/stage2/RPM-GPG-KEY-CentOS-6 ]; then
	mypart=ext4
fi

echo 'part swap --size=2048' > /tmp/disk.cfg
echo "part / --fstype=${mypart} --grow --size=200" >> /tmp/disk.cfg
%end

%packages --nocore --nobase
@core --nodefaults
%end

%post
exec < /dev/console > /dev/console
myrel=`awk '{print $3}' /etc/centos-release`
if [ "${myrel}" = 'release' ]; then
	myrel=`awk '{print $4}' /etc/centos-release`
fi
yum --releasever=${myrel} -y update
%end
